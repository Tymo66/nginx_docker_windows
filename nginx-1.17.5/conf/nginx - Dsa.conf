worker_processes  1;
 
events {
    worker_connections  1024;
}
 
 
http {
    include       mime.types;
    default_type  application/octet-stream;
 
    sendfile        on;
 
    keepalive_timeout  65;
 
    client_max_body_size 1500M;
     
    # Setup DSA application website
    server {
         
        # Define port for http and host names
        listen       80;
        server_name  127.0.0.1 localhost;
         
        # Define HTTPS port
        listen 3000 ssl;
         
        # Define SSL certificates
        ssl_certificate     c:/nginx/conf/noldusdefault.cert.crt;
        ssl_certificate_key c:/nginx/conf/noldusdefault.cert.key;
 
        location / {
            root   html;
            index  index.html index.htm;
        }

        #location / {
        #     # Define path to the React application
        #     root   c:/nginx/html/DSA_application;
        #     index  index.html index.htm;
        #      
        #     # React app router
        #     try_files $uri /index.html;
        #}
 
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
 
    # Setup reverse proxy for DSA Web API website which runs on Kesterl on URL http://localhost:5000
    server {
        # Define port for http and host names
        listen       2007;
        server_name  127.0.0.1 localhost;
         
        # Define HTTPS port
        listen 44399 ssl;
         
        # Define SSL certificates
        ssl_certificate     c:/nginx/conf/noldusdefault.cert.crt;
        ssl_certificate_key c:/nginx/conf/noldusdefault.cert.key;
 
        location / {
            # Define URL of the DSA Web API which runs on Kestrel
            proxy_pass              https://localhost:5001;
  
            # The default minimum configuration required for ASP.NET Core
            # See https://docs.asp.net/en/latest/publishing/linuxproduction.html?highlight=nginx#configure-a-reverse-proxy-server
            proxy_cache_bypass      $http_upgrade;
            # Turn off changing the URL's in headers like the 'Location' HTTP header.
            proxy_redirect          off;
            # Forwards the Host HTTP header.
            proxy_set_header        Host $host;
            # The Kestrel web server we are forwarding requests to only speaks HTTP 1.1.
            proxy_http_version      1.1;
            proxy_set_header        Upgrade $http_upgrade;
            # Adds the 'Connection: keep-alive' HTTP header.
            proxy_set_header        Connection keep-alive;
  
            # Sets buffer size for reading client request body.
            client_body_buffer_size 128k;
            # Defines a timeout for establishing a connection with a proxied server.
            proxy_connect_timeout   90;
            # Sets a timeout for transmitting a request to the proxied server.
            proxy_send_timeout      90;
            # Defines a timeout for reading a response from the proxied server.
            proxy_read_timeout      90;
            # Sets the number and size of the buffers used for reading a response from the proxied server.
            proxy_buffers           32 4k;
        }
         
        # Define SingnalR hubs 
        location /statusHub {
            proxy_pass https://localhost:5001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
         
        location /eyeTrackerStreamHub {
            proxy_pass https://localhost:5001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
         
        location /sessionElapsedTimeHub {
            proxy_pass https://localhost:5001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
         
        location /WebRtcHub {
            proxy_pass https://localhost:5001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
         
        location /movementStreamHub {
            proxy_pass https://localhost:5001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
 
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
 
}